### 2022/09/19/월

진작 시작했어야 했던 개발일지를 4주차가 시작한 지금에서야 적는다.

오늘은 중간발표가 있는 날이였다. 완성된 코드가 적어 서비스 설명과 기술설명 위주로 발표가 진행됐다. 지난 공통 프로젝트땐 그래도 실제 구현된 것들을 꽤 많이 보여줬던것 같은데 이번엔 우리팀도, 다른팀도 일정이 빡빡해서 개발된 모습을 보여준 팀은 없었다. 시간이 생각보다 남지 않은만큼 서둘러야 겠다.

오늘 A606 팀과의 코드리뷰를 시작했다. 아직 제대로 보진 않았는데, 잘하는분이 있는것 같아 배울점이 많을 것  같다.

게임을 제외하고 FE에서 중요한 부분이 그나마 Web3를 이용한 smart contract 호출인데, smart contract 완성까지도 오래 걸릴 것 같고 이용하려면 제대로 알고 써야하기에 solidity에 대한 공부를 시작했다. 프로젝트 초기에 싸피에서 간단하게 알려주는 개념이 조금씩 구체화 되어가는 중이다.



### 2022/09/21/수

스마트 컨트렉트를 계속 공부하고 내일 있을 테크톡을 위해 공부한 내용을 정리했다.

잘 이해 안되는 부분은 EVM이였는데, 이더리움 네트워크 노드에서 EVM이 작동된다지만 작동시키는 노드는 어떤 기준인지 가까운 순인지 쉬고있는 노드인지, 한 노드만 할당되는지 그런 것도 궁금했다. 그리고 코인의 개념도 아직 잘 안잡히는데 코인이 어떤 주소에 담겨있다는걸 어떻게 표현되는지 어떻게 입증하는지 하는 부분은 그냥 거래 기록이 담긴다는 것을 제외하면 완벽히 이해하진 못했다.



### 2022/09/22/목

MetaMask를 통해서 회원가입을 해야하면 첫 회원들의 진입장벽이 높다고 생각되어 이메일과 닉네임 만으로 회원가입이 가능하게 변경했다. 비밀번호 찾기는 이전에 석호, 민지누나네 팀이 만들었던 기능이 있어 이메일 보내기로 비밀번호 찾기가 가능하게 되었다. 약간 아쉬운 점은 회원가입시 비밀번호를 입력하는 것이 아니라 가입한 이메일로 들어가 랜덤으로 받은 첫 비밀번호를 찾고 회원가입 수정에서 변경해야 한다는 점 이였다.

회원정보 수정 페이지 구현은 어렵진 않지만 인풋이 많고 여러 필터를 넣어야 해서 최대한 깔끔히 만들어도 먼가 지저분한 느낌이 든다.



### 2022/09/23/금

어제까지 smart contract에 대해 공부했으며, 더 붙잡고 있으면 FE를 완성하지 못할 것 같아 FE로 다시 넘어왔다. 결국 며칠동안 완성한 것은 없지만, 그래도 이더리움 네트워크에 대해 좀 이해가 됐으며, 아예 시간을 날린것 같진 않다.

오늘 Game부분 구현을 위해 sockJS로 websocket을 사용하고 그 위에 stompJS로 sub protocol stomp를 사용했다. 아직 back 부분 구현이 안돼서 제대로 작동하는지 확인하며 작업할 수 없다는 점이 불안하지만, 일단 최대한 완벽하게 구현해놓고 나중에 백과 맞춰봤을때 에러가 나는 부분들을 다시 수정해 나가야 겠다.

1학기 같은반인 경욱이네 공통프로젝트 깃헙을 많이 참고했다. 문제는 typescript를 위해 @stomp/stompjs를 사용하는데 여기서 clinet.send가 아니라 client.publish를 사용한다는 점이다. 다른 프로젝트를 보면 일반적인 stompjs를 사용하기에 send 메소드를 사용하는데 둘의 차이를 아직 정확하게 찾지 못했다.



### 2022/09/24/토

보경이가 게임부분을 맡아 하다가 그제 내가 넘겨받게 되었는데, 기존에 진행하던 방식으론 제대로 구현할 수 없을것 같아 이 부분을 말한 뒤 상당부분을 지우고 다시했다. 여기서 안타까웠던 점은 CSS인데, 나는 기능을 모두 마치고 그 다음 CSS를 진행하지만, 보경이나 석호에게 들어보니 CSS도 같이 진행하는게 편하다는 답변을 들었다. 물론 개인의 취향이겠지만 만약 CSS를 나중에 했다면 오늘처럼 코드를 새로 다시해야 될 때 덜 아깝지 않을까 생각된다. 이 부분은 누가 맞고 틀리다를 얘기하긴 힘들겠지만 나는 아직까지 기능을 마치고 CSS에 들어가는게 좋은것 같다.



### 2022/09/25/일

BGM을 어떻게 해야 여러 페이지를 이동해도 않끊기고 재생시킬 수 있을까 고민하다 그냥 최상위 컴포넌트로 레이어를 하나 만들었다.

이 레이어의 audio player를 조절 할 수 있는 useBGM을 만들어 노래 종류나 볼륨, 재생을 조절할 수 있도록 했다.



### 2022/09/26/월

주말에 백그라운드 음악 레이어를 만들었으며 오늘은 모달을 위한 레이어를 만들었다. 한가지 문제점은 메인 -> 게임리스트로 이동시 노래가 잘 바뀌지만, 이상하게 게임리스트 -> 게임으로는 노래가 바뀌지 않고 재생 또한 안된다는 점이였다. 예상되는 원인을 따라 디버깅을 꽤 많이 했지만 결국 실패했다. 마지막 남은 원인은 백 API 구현이 안되어 생기는 에러들로 인한것으로 백이 완성됐을때 한번 더 확인해보고 안된다면 다시 생각해 봐야 겠다.



### 2022/09/27/화

방 입장 모달, 방 만들기 모달을 완성했으며, 더미파일을 API문서에 맞춰 만들었다.

서비스에서 모달이 매우 많이 필요하기에 모달도 BGM처럼 상위 컴포넌트로 넣었으며, useModal을 이용해 모달을 띄웠다 내렸다 할 수 있게 했다. 다만 확인, 취소가 있는 confirm 모달은 결과값을 받아 이용해야 하는데 redux에 결과를 담아 이용해야 한다는 점이 아쉬웠다. 더 나은 방법이 있을 것 같은데 아직 확실히 떠오르진 않는다.



### 2022/09/28/수

백 API가 완성되지 않은 상황에서 프런트를 짜기란 쉽지 않은 것 같다. 시작 전에 API문서를 만들어 놓고 시작하더라도 백에서 구현을 하다보면 달라지는 부분이 생기고, 백이 달라지면 프런트에서 구현했던 부분들을 매우 많이 수정해야한다. 오늘 방 입장하는 방식이 변경됐는데, 어제 3시간 가량을 투자해서 만든 부분이라 상당히 허무함을 느꼈다. 이를 통해 기획, 설계 단계에서 최대한 모든 경우의 수를 생각하고 완벽히 짜놓아야 한다는걸 다시 한번 느꼈다.



### 2022/09/30/금

거래페이지와 출품(투표)페이지의 틀을 만들고 거기에 보경이와 민지누나가 만든 Web3.js를 연결시켰다. smart contract를 직접 만들지 않았기에 web3부분에 두려움이 있었지만 그래도 금방 할 수 있을것 같아 해보고 싶었다. 하지만 아쉽게 보경이의 역할이 되어 민지누나와 둘이 함수에 들어가야 하는 인자 내용이나 순서를 공유해가며 어제 금방 web3부분을 만들었다. 나는 이를 가져와서 적절한 위치에 넣고, 그 결과를 백에게 알려주는 API와 연결시켰다.



### 2022/10/1/토

어제 거래페이지가 완성됐고, 오늘은 거래 등록 페이지를 자세히 구현했는데 현재 시간으로 부터 1일이나 2일 뒤의 시간을 거래 종료 시간으로 백에 넘겨줘야 했다. 백의 시간 체계에 맞춰 JS에서 date함수를 가공해야 했는데, 우려와는 달리 생각보다 쉽게 가공할 수 있었다. const date = new Date(now.setDate(now.getDate() + day)) 로 n일을 더한 날자를 만들고 slice로 날자를 포멧팅하여 API에 넣어 백으로 보냈다.



### 2022/10/2/일

커서 이미지와 클릭시 효과음을 넣었다. 기본 커서 이미지는 최상위 div에서 cursor: url(), auto;를 통해 설정 가능했으나 버튼과 같이 호버했을 시 커서이미지가 변하는 부분도 한번에 지정하는 방법은 찾지 못했다. 따라서 하나씩 일일이 지정해 주었다.

Rest API에서 date를 받는 path에 변경이 생겨 수정하였다. 이전엔 result.data에 담겨보내줬다면, 이제는 result.data.response로 백 인원끼리 통일해서 보내주게 되었다.



### 2022/10/3/월

석호가 socket부분 구현을 대부분 한 것 같아 게임 구현을 시작했다. 이전에 어느정도 진행했던 부분을 다 지우고 새로 시작했다. 가장 오래걸린 부분은 역시 게임을 백에서 어떤식으로 생각하고 있고, 어떤 socket에서 어떤 정보를 어떤 형식으로 받는지, 어떤 이벤트가 어떤 조건에서 발생해서 프런트에 정보로 넘어오는지 파악하는 것이였다. socket은 swagger에도 나오지 않고, 엑셀로 열심히 API문서를 만들어 놓긴 했지만 변경점들이 계속 업데이트 되지 않았고, data 양식을 변수명까지 모두 써달라고 하기 미안해서 하나씩 테스트해보며 구현을 진행했다. 아무리 생각해도 문서나 컨벤션은 정말 중요한 것 같다.



### 2022/10/4/화

socket 주소중 일부에는 첫 소켓 연결시 받게되는 userSessionId를 variable routing으로 사용하는데, 이에 관해 여러 이슈가 있었다. 우선 subscribe하는 주소들은 모두 onConnected 될 때의 콜백함수로 넣어두었으며 처음 연결되면 userSessionId를 useState에 저장하여 다른 주소에서 사용되도록 했다. 생각해보면 subscribe를 정의 할 때 useSessionId가 정의되어 있지 않기때문에 당연히 잘못된 방식인데 멍청했다. 이를 해결하기 위해 useSessionId 가 필요한 연결들은 cliecnt.onConnected(() => {}) 에 정의하지 않고, useEffect에서 userSessionId가 변화하면 client.subscribe() 를 통해 연결하도록 설정했다. 이때도 cleanup function을 설정해주지 않았더니 계속 연결이 중첩되어 같은 메시지를 여러번 받게되는 이슈가 있었다.

하위 컴포넌트 들에서도 client를 사용해야 했는데, 그냥 client를 props로 넘겼더니 원하는대로 구현되지 않았다. stompJS문서에도 나오지 않아 구글링을 진짜 많이 해보고 나서야 useState에 client객체를 저장해놓고 이를 props로 넘기면 된다는 것을 알 수 있었다. 이는 게임컴포넌트에서 client가 정의되면서 비동기로 연결을 시도하는데 props로 넘겨주는것은 연결되지 않은 client 객체이고, useState를 사용하지 않으면 최신화가 안되기 때문에 생기는 문제로 예상된다. 구글링을 하지 않고도 예상했어야 하는 이슈였다.

게임 아이템들을 구현했다. 타이머나 점수의 경우 백에서 처리하기 때문에 크게 할 일은 없었고 타이머는 사용 된 아이템 중에서 시간 관련 아이템이 있을 경우 그만큼 빼주는 처리만 해줬다. 다만 카드를 흑백으로 만들거나 카드 일부를 가리는 부분은 카드컴포넌트에서 따로 처리를 해줘야 했다. 흑백은 CSS filter로 쉽게 구현 가능했으며 문제는 카드 일부 가리기였는데, 몇가지 방법이 떠올랐다. 첫번째는 효과능력치에 따라 장애물을 생성해서 카드위 랜덤한 위치에 뿌려놓는 것이였고, 두번째는 카드 일부를 크롭해서 키워 다른부분은 볼 수 없도록 하는 것이며, 세번째는 준비된 이미지를 카드 위에 덮어씌우는 것이였다. 추가로 개발자도구에서 이미지를 확인해도 원본 이미지를 보지 못하도록 새로 이미지를 만들고 이 새로운 이미지를 띄우고 싶었으나, 남은 플젝 기간에서 노력대비 큰 의미가 없는것 같아 구현하지 않았다.



### 2022/10/5/수

게임방 입장하기를 누르면 비밀번호 확인과정을 거쳐야 하는데, 입장하기를 누르는 순간 웹소켓은 연결되도록 해놨었다. 때문에 한가지 문제가 생기는데, 비밀번호를 몰라 방에 입장을 못해도 방의 게임시작을 방해 할 수 있었다. 비밀번호 확인과정을 거쳐야 소켓을 연결하도록 하여 해결했다.

게임 결과화면을 구현했는데, JS의 sort 메소드를 거의 처음 활용해보는것 같았다. 

게임 결과 상태나 채팅 상태에는 유저들의 프로필 사진이 없는데, 프로필을 띄울 수 있도록 게임방 players 정보에서 프로필을 가져오는 함수를 만들었다.

게임봇을 만들었다. 아이템을 더블클릭해서 사용해야 하는데, 처음 사용자는 더블클릭인지 모를것 같아 이를 게임봇을 통해 알려주고, 아이템 사용시 게임봇을 통해 사용되었음을 알려주었다.



### 2022/10/6/목

오프라인에서 구현한 게임을 같이 해보고 CSS를 만졌다. 또 발표를 어떤식으로 진행할 지 다 같이 회의시간을 가졌다. 한가지 걱정되는 것은 코치님께 게임을 보여드렸는데, 뭐 하는 게임인지 잘 모르겠으며 뭘 해야 할 지도 잘 모르겠다는 평을 들었다는 것이다. 구현만 돼있고 CSS가 하나도 되어있지 않아 그런 부분도 있겠지만, 우리 메인서비스인 게임이 조금 어렵거나 매력적이지 않은가 하는 생각도 들었다.